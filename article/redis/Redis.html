<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <link rel="icon" href="https://my-photos-1.oss-cn-hangzhou.aliyuncs.com/Individual/logo.png"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#21332d"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><link rel="icon" href="/logo.png"><title>Redis 简单使用</title><meta name="description" content="Redis 简单使用">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-42911d78.css" as="style"><link rel="stylesheet" href="/assets/style-42911d78.css">
    <link rel="modulepreload" href="/assets/app-f746a503.js"><link rel="modulepreload" href="/assets/framework-ec2af7a3.js"><link rel="modulepreload" href="/assets/Redis.html-0b126977.js"><link rel="modulepreload" href="/assets/Redis.html-1855d00e.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><!----></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><FontIcon icon="zhuye"></FontIcon>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/guide/" class="nav-link" aria-label="导航"><FontIcon icon="tubiaozhuanqu-16"></FontIcon>导航<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="编程语言"><span class="title"><FontIcon icon="code"></FontIcon>编程语言</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/java/" class="nav-link" aria-label="Java"><FontIcon></FontIcon>Java<!----></a></li><li class="dropdown-item"><a href="/article/go/" class="nav-link" aria-label="Go"><FontIcon></FontIcon>Go<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/article/algorithm/" class="nav-link" aria-label="算法"><FontIcon icon="jichengsuanfa"></FontIcon>算法<!----></a></div><div class="nav-item hide-in-mobile"><a href="/article/springs/" class="nav-link" aria-label="Springs"><FontIcon icon="bxl-spring-boot"></FontIcon>Springs<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><FontIcon icon="database-full"></FontIcon>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/mysql/" class="nav-link" aria-label="MySQL"><FontIcon></FontIcon>MySQL<!----></a></li><li class="dropdown-item"><a href="/article/redis/" class="nav-link active" aria-label="Redis"><FontIcon></FontIcon>Redis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="设计"><span class="title"><FontIcon icon="sheji1"></FontIcon>设计</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/design/" class="nav-link" aria-label="设计模式"><FontIcon></FontIcon>设计模式<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="中间件"><span class="title"><FontIcon icon="zhongjianjian"></FontIcon>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/rabbitmq/" class="nav-link" aria-label="RabbitMQ"><FontIcon></FontIcon>RabbitMQ<!----></a></li><li class="dropdown-item"><a href="/article/elasticsearch/" class="nav-link" aria-label="ElasticSearch"><FontIcon></FontIcon>ElasticSearch<!----></a></li><li class="dropdown-item"><a href="/article/mongodb/" class="nav-link" aria-label="Mongodb"><FontIcon></FontIcon>Mongodb<!----></a></li><li class="dropdown-item"><a href="/article/netty/" class="nav-link" aria-label="Netty"><FontIcon></FontIcon>Netty<!----></a></li><li class="dropdown-item"><a href="/article/quartz/" class="nav-link" aria-label="Quartz"><FontIcon></FontIcon>Quartz<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="运维"><span class="title"><FontIcon icon="yunwei-yunweirizhi"></FontIcon>运维</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/article/git/" class="nav-link" aria-label="Git"><FontIcon></FontIcon>Git<!----></a></li><li class="dropdown-item"><a href="/article/docker/" class="nav-link" aria-label="Docker"><FontIcon></FontIcon>Docker<!----></a></li><li class="dropdown-item"><a href="/article/jenkins/" class="nav-link" aria-label="Jenkins"><FontIcon></FontIcon>Jenkins<!----></a></li><li class="dropdown-item"><a href="/article/linux/" class="nav-link" aria-label="Linux"><FontIcon></FontIcon>Linux<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/article/modeling/" class="nav-link" aria-label="数学建模"><FontIcon icon="qita"></FontIcon>数学建模<!----></a></div><div class="nav-item hide-in-mobile"><a href="/article/other/" class="nav-link" aria-label="其他文章"><FontIcon icon="qita"></FontIcon>其他文章<!----></a></div><div class="nav-item hide-in-mobile"><a href="/about/" class="nav-link" aria-label="关于"><FontIcon icon="guanyu1"></FontIcon>关于<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button class="search-pro-button" role="search" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/article/redis/" class="nav-link sidebar-link sidebar-page" aria-label="Redis"><FontIcon></FontIcon>Redis<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/article/redis/%E7%BC%93%E5%AD%98%E8%BF%9B%E9%98%B6.html" class="nav-link sidebar-link sidebar-page" aria-label="缓存进阶"><FontIcon icon="缓存进阶"></FontIcon>缓存进阶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/article/redis/Redis.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Redis 简单使用"><FontIcon></FontIcon>Redis 简单使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><div><!----><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><FontIcon icon></FontIcon>Redis 简单使用</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">gzw</span></span><span property="author" content="gzw"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-02-22T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 18 min</span><meta property="timeRequired" content="PT18M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category5 clickable" role="navigation">redis</span><span class="page-category-item category6 clickable" role="navigation">数据库</span><span class="page-category-item category5 clickable" role="navigation">缓存</span><meta property="articleSection" content="redis,数据库,缓存"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag5 clickable" role="navigation">redis</span><span class="page-tag-item tag6 clickable" role="navigation">数据库</span><span class="page-tag-item tag5 clickable" role="navigation">缓存</span><meta property="keywords" content="redis,数据库,缓存"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#redis-简单使用" class="router-link-active router-link-exact-active toc-link level1">Redis 简单使用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_1-redis的相关问题" class="router-link-active router-link-exact-active toc-link level1">1.Redis的相关问题</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_1-1-redis-conf" class="router-link-active router-link-exact-active toc-link level2">1.1 Redis.conf</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_2-性能测试" class="router-link-active router-link-exact-active toc-link level1">2.性能测试</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_2-1-redis-benchmark-命令参数" class="router-link-active router-link-exact-active toc-link level2">2.1 redis-benchmark 命令参数</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-redis的基础知识" class="router-link-active router-link-exact-active toc-link level1">3.Redis的基础知识</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-1-基础语法" class="router-link-active router-link-exact-active toc-link level2">3.1  基础语法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-2-基本类型" class="router-link-active router-link-exact-active toc-link level2">3.2 基本类型</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-2-1-string" class="router-link-active router-link-exact-active toc-link level3">3.2.1 String</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-2-2-list" class="router-link-active router-link-exact-active toc-link level3">3.2.2 List</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-2-3-set" class="router-link-active router-link-exact-active toc-link level3">3.2.3 Set</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-2-4-hash" class="router-link-active router-link-exact-active toc-link level3">3.2.4 Hash</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-2-5-zset" class="router-link-active router-link-exact-active toc-link level3">3.2.5 Zset</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-3-特殊类型" class="router-link-active router-link-exact-active toc-link level2">3.3 特殊类型</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-3-1-geospatial" class="router-link-active router-link-exact-active toc-link level3">3.3.1 geospatial</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-3-2-hyperloglog" class="router-link-active router-link-exact-active toc-link level3">3.3.2 hyperloglog</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_3-3-3-bitmaps" class="router-link-active router-link-exact-active toc-link level3">3.3.3 bitmaps</a></li><!----><!--]--></ul><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_4-事务" class="router-link-active router-link-exact-active toc-link level1">4.事务</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_5-jedis" class="router-link-active router-link-exact-active toc-link level1">5.Jedis</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_6-spring-boot-整合-redis" class="router-link-active router-link-exact-active toc-link level1">6.Spring Boot 整合 redis</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_7-redis-持久化" class="router-link-active router-link-exact-active toc-link level1">7.Redis 持久化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_7-1-rdb" class="router-link-active router-link-exact-active toc-link level2">7.1 rdb</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_7-2-aof" class="router-link-active router-link-exact-active toc-link level2">7.2 aof</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_8-redis-的发布订阅" class="router-link-active router-link-exact-active toc-link level1">8.Redis 的发布订阅</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_9-redis-主从复制" class="router-link-active router-link-exact-active toc-link level1">9.Redis 主从复制</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_9-1-哨兵模式" class="router-link-active router-link-exact-active toc-link level2">9.1 哨兵模式</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/article/redis/Redis.html#_10-redis-缓存穿透、击穿、雪崩" class="router-link-active router-link-exact-active toc-link level1">10.Redis 缓存穿透、击穿、雪崩</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="redis-简单使用" tabindex="-1"><a class="header-anchor" href="#redis-简单使用" aria-hidden="true">#</a> Redis 简单使用</h1><h1 id="_1-redis的相关问题" tabindex="-1"><a class="header-anchor" href="#_1-redis的相关问题" aria-hidden="true">#</a> 1.Redis的相关问题</h1><ul><li><p>redis是单线程的，是基于内存操作的，CPU不是redis的性能瓶颈，redis的瓶颈在于机器的内存和网络带宽，官方表示这可以使用单线程实现，便使用单线程了</p></li><li><p>redis将所有的数据放在了内存中，使用单线程是最快的。倘若使用多线程，会在CPU中进行上下文切换，这是非常耗时的</p></li></ul><h2 id="_1-1-redis-conf" tabindex="-1"><a class="header-anchor" href="#_1-1-redis-conf" aria-hidden="true">#</a> 1.1 Redis.conf</h2><p><strong>【】中的为具体的自定义配置</strong></p><table><thead><tr><th style="text-align:center;">序号</th><th style="text-align:center;">参数</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">unit</td><td style="text-align:center;">单位，对大小写不敏感</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">include 【path】</td><td style="text-align:center;">可以将多个配置文件引入组合成一个</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">bind 【ip】</td><td style="text-align:center;">绑定 ip</td></tr><tr><td style="text-align:center;">4</td><td style="text-align:center;">pretected-mode 【yes | no】</td><td style="text-align:center;">是否开启受保护模式，默认为 yes</td></tr><tr><td style="text-align:center;">5</td><td style="text-align:center;">port 【port】</td><td style="text-align:center;">设置端口</td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;">daemonize 【yes | no】</td><td style="text-align:center;">是否以守护进程的方式运行，默认是 no</td></tr><tr><td style="text-align:center;">7</td><td style="text-align:center;">pidfile 【path】</td><td style="text-align:center;">指定 pid 文件，让 redis 在后台运行</td></tr><tr><td style="text-align:center;">8</td><td style="text-align:center;">loglevel 【level】</td><td style="text-align:center;">指定日志级别</td></tr><tr><td style="text-align:center;">9</td><td style="text-align:center;">logfile 【path】</td><td style="text-align:center;">日志文件的位置</td></tr><tr><td style="text-align:center;">10</td><td style="text-align:center;">database 【sum】</td><td style="text-align:center;">数据库的数量，默认为 16</td></tr><tr><td style="text-align:center;">11</td><td style="text-align:center;">always-show-logo 【yes | no】</td><td style="text-align:center;">是否总是显示 logo</td></tr><tr><td style="text-align:center;">12</td><td style="text-align:center;">save 【time】 【keyNum】</td><td style="text-align:center;">在 time 时间（单位为：s）内修改了 keyNum 个 key 就将数据持久化到 .rdb/.aof 文件</td></tr><tr><td style="text-align:center;">13</td><td style="text-align:center;">stop-writes-on-bgsave-error 【yes | no】</td><td style="text-align:center;">如果持久化出错，是否还需要继续工作，默认 yes</td></tr><tr><td style="text-align:center;">14</td><td style="text-align:center;">rdbcompression 【yes | no】</td><td style="text-align:center;">是否压缩 rdb 文件，默认 yes</td></tr><tr><td style="text-align:center;">15</td><td style="text-align:center;">dir 【path】</td><td style="text-align:center;">rdb 文件的保存目录</td></tr><tr><td style="text-align:center;">16</td><td style="text-align:center;">requirepass 【pwd】</td><td style="text-align:center;">设置密码，默认为空</td></tr><tr><td style="text-align:center;">17</td><td style="text-align:center;">maxclients 【sum】</td><td style="text-align:center;">最大连接数量</td></tr><tr><td style="text-align:center;">18</td><td style="text-align:center;">maxmemory 【size】</td><td style="text-align:center;">redis 配置的最大内存容量，单位为 byte</td></tr><tr><td style="text-align:center;">19</td><td style="text-align:center;">maxmemory-policy noeviction</td><td style="text-align:center;">内存达到上限之后的处理策略</td></tr><tr><td style="text-align:center;">20</td><td style="text-align:center;">appendonly 【yes | no】</td><td style="text-align:center;">是否使用 aof 持久化模式，默认为 no，即使用 rdb</td></tr><tr><td style="text-align:center;">21</td><td style="text-align:center;">appendfilename 【filename】</td><td style="text-align:center;">持久化文件的名称</td></tr><tr><td style="text-align:center;">22</td><td style="text-align:center;">appendsync everysec</td><td style="text-align:center;">每秒都执行一次同步数据的操作</td></tr></tbody></table><p>p28</p><h1 id="_2-性能测试" tabindex="-1"><a class="header-anchor" href="#_2-性能测试" aria-hidden="true">#</a> 2.性能测试</h1><p>redis-benchmark 是 redis 官方自带的一个压力测试工具</p><h2 id="_2-1-redis-benchmark-命令参数" tabindex="-1"><a class="header-anchor" href="#_2-1-redis-benchmark-命令参数" aria-hidden="true">#</a> 2.1 redis-benchmark 命令参数</h2><table><thead><tr><th>序号</th><th style="text-align:left;">选项</th><th style="text-align:left;">描述</th><th style="text-align:left;">默认值</th></tr></thead><tbody><tr><td>1</td><td style="text-align:left;">-h</td><td style="text-align:left;">指定服务器主机名</td><td style="text-align:left;">127.0.0.1</td></tr><tr><td>2</td><td style="text-align:left;">-p</td><td style="text-align:left;">指定服务器端口</td><td style="text-align:left;">6379</td></tr><tr><td>3</td><td style="text-align:left;">-s</td><td style="text-align:left;">指定服务器socket</td><td style="text-align:left;">/</td></tr><tr><td>4</td><td style="text-align:left;">-c</td><td style="text-align:left;">指定并发连接数</td><td style="text-align:left;">50</td></tr><tr><td>5</td><td style="text-align:left;">-n</td><td style="text-align:left;">指定请求数</td><td style="text-align:left;">10000</td></tr><tr><td>6</td><td style="text-align:left;">-d</td><td style="text-align:left;">以字节的形式指定SET/GET值的数据大小</td><td style="text-align:left;">2</td></tr><tr><td>7</td><td style="text-align:left;">-k</td><td style="text-align:left;">1=keep alive 0 = reconnect</td><td style="text-align:left;">1</td></tr><tr><td>8</td><td style="text-align:left;">-r</td><td style="text-align:left;">SET/GET/INCR 使用随机key，SADD使用随机值</td><td style="text-align:left;">/</td></tr><tr><td>9</td><td style="text-align:left;">-p</td><td style="text-align:left;">通过管道传输<code>&lt;numreq&gt;</code>请求</td><td style="text-align:left;">1</td></tr><tr><td>10</td><td style="text-align:left;">-q</td><td style="text-align:left;">强制退出redis，仅显示query/sec值</td><td style="text-align:left;">/</td></tr><tr><td>11</td><td style="text-align:left;">--csv</td><td style="text-align:left;">以CSV格式输出</td><td style="text-align:left;">/</td></tr><tr><td>12</td><td style="text-align:left;">-l</td><td style="text-align:left;">生成循环，永久执行测试</td><td style="text-align:left;">/</td></tr><tr><td>13</td><td style="text-align:left;">-t</td><td style="text-align:left;">仅运行以逗号分隔的测试命令列表</td><td style="text-align:left;">/</td></tr><tr><td>14</td><td style="text-align:left;">-l</td><td style="text-align:left;">Idle模式，仅打开N个idle连接并等待</td><td style="text-align:left;">/</td></tr></tbody></table><h1 id="_3-redis的基础知识" tabindex="-1"><a class="header-anchor" href="#_3-redis的基础知识" aria-hidden="true">#</a> 3.Redis的基础知识</h1><p>redis默认有16个数据库，默认使用第0个</p><h2 id="_3-1-基础语法" tabindex="-1"><a class="header-anchor" href="#_3-1-基础语法" aria-hidden="true">#</a> 3.1 基础语法</h2><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>select 0~15</code></td><td>切换数据库</td></tr><tr><td>2</td><td><code>dbsize</code></td><td>查看当前数据库的空间大小</td></tr><tr><td>3</td><td><code>set 键 值</code></td><td>储存数据</td></tr><tr><td>4</td><td><code>get 键</code></td><td>获取键对应的值</td></tr><tr><td>5</td><td><code>keys *</code></td><td>查看当前数据库中所有的键</td></tr><tr><td>6</td><td><code>flushdb</code></td><td>清空当前数据库</td></tr><tr><td>7</td><td><code>flushall</code></td><td>清空所有数据库</td></tr><tr><td>8</td><td><code>exists 键</code></td><td>查看当前数据库是否存在这个键</td></tr><tr><td>9</td><td><code>move 键 值</code></td><td>移除当前数据库中的指定键值对</td></tr><tr><td>10</td><td><code>expire 键 时间</code></td><td>指定时间结束后过期，即删除该键值对</td></tr><tr><td>11</td><td><code>ttl 键</code></td><td>查看指定键值对剩余存活时间</td></tr><tr><td>12</td><td><code>append 键 追加的值</code></td><td>向指定键的值后追加值</td></tr></tbody></table><h2 id="_3-2-基本类型" tabindex="-1"><a class="header-anchor" href="#_3-2-基本类型" aria-hidden="true">#</a> 3.2 基本类型</h2><h3 id="_3-2-1-string" tabindex="-1"><a class="header-anchor" href="#_3-2-1-string" aria-hidden="true">#</a> 3.2.1 String</h3><ul><li>相关的用法</li></ul><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>strlen 键</code></td><td>查看对应值的长度</td></tr><tr><td>2</td><td><code>incr 键</code></td><td>让指定键的值自动加1，并显示</td></tr><tr><td>3</td><td><code>decr 键</code></td><td>让指定键的值自动减1，并显示</td></tr><tr><td>4</td><td><code>incrby 键 增量</code></td><td>让指定键的值增加指定的增量</td></tr><tr><td>5</td><td><code>decrby 键 减量</code></td><td>让指定键的值减少指定的减量</td></tr><tr><td>6</td><td><code>getrange 键 起始下标 结束下标</code></td><td>得到指定键中指定范围的值</td></tr><tr><td>7</td><td><code>setrange 键 起始下标 修改的值</code></td><td>替换指定键中起始下标及往后的值为指定修改的值</td></tr><tr><td>8</td><td><code>setex 键 过期时间 值</code></td><td>setex : set with expire，存入键值对并指定过期时间</td></tr><tr><td>9</td><td><code>setnx 键 值</code></td><td>setnx : set if not exist，如果不存在再添加（分布式锁中常用）</td></tr><tr><td>10</td><td><code>mset 键1 值1 键2 值2 ...</code></td><td>同时设置多个键值对</td></tr><tr><td>11</td><td><code>mget 键1 键2 ...</code></td><td>同时获取多个值</td></tr><tr><td>12</td><td><code>msetnx 键1 值1 键2 值2</code></td><td>不存在才添加，原子性操作，只有全部不存在才能成功</td></tr><tr><td>13</td><td><code>getset 键 新值</code></td><td>如果存在值才获取对应的值，然后再设置新的值</td></tr></tbody></table><h3 id="_3-2-2-list" tabindex="-1"><a class="header-anchor" href="#_3-2-2-list" aria-hidden="true">#</a> 3.2.2 List</h3><p>注：在list中，值是可以重复的，左与前对应，右与后对应，带字母 “ l ” 的命令中的 “ l ” 含义有时是list，有时是left</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>lpush list名 值</code></td><td>从左侧添加值（头部）</td></tr><tr><td>2</td><td><code>rpush list名 值</code></td><td>从右侧添加值（尾部）</td></tr><tr><td>3</td><td><code>lrange list名 起始下标 结束下标</code></td><td>查看一定范围内list的值</td></tr><tr><td>4</td><td><code>lpop list名</code></td><td>移除list左侧第一个值</td></tr><tr><td>5</td><td><code>rpop list名</code></td><td>移除list右侧第一个值</td></tr><tr><td>6</td><td><code>lindex list名 index</code></td><td>获取index索引对应的值</td></tr><tr><td>7</td><td><code>llen list名</code></td><td>获取list的长度</td></tr><tr><td>8</td><td><code>lrem list名 数量 需要移除的值</code></td><td>移除指定的值</td></tr><tr><td>9</td><td><code>ltrim list名 起始下标 结束下标</code></td><td>只保留范围内的值（删除其余的值）</td></tr><tr><td>10</td><td><code>rpoplpush 被pop的list1名 被push的list2名</code></td><td>将list1最右边值移除并添加到list2的最左边（这是一个组合命令 ）</td></tr><tr><td>11</td><td><code>lset list名 index 新值</code></td><td>更新list里index索引对应的值为新值</td></tr><tr><td>12</td><td>`linsert list名 before</td><td>after 指定值 插入值`</td></tr></tbody></table><h3 id="_3-2-3-set" tabindex="-1"><a class="header-anchor" href="#_3-2-3-set" aria-hidden="true">#</a> 3.2.3 Set</h3><p>注：set中的值是不可以重复的，也是无序的</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>sadd set名 值</code></td><td>添加值</td></tr><tr><td>2</td><td><code>smembers set名</code></td><td>查看值</td></tr><tr><td>3</td><td><code>sismember set名 被判断的值</code></td><td>判断set中是否有被判断的值，有则返回，否则返回0</td></tr><tr><td>4</td><td><code>scard set名</code></td><td>获取set集合中的元素个数</td></tr><tr><td>5</td><td><code>srem set名 指定值</code></td><td>移除set中指定的值</td></tr><tr><td>6</td><td><code>srandmember set名</code></td><td>从set中随机取出一个值</td></tr><tr><td>7</td><td><code>spop set名</code></td><td>从set中随机移除一个值</td></tr><tr><td>8</td><td><code>smove 被移除的set1名 被移入的set2名 指定值</code></td><td>将set1中指定的值移入到set2中</td></tr><tr><td>9</td><td><code>sdiff set1名 set2名</code></td><td>获得两个set的差集</td></tr><tr><td>10</td><td><code>sinter set1名 set2名</code></td><td>获得两个set的交集</td></tr><tr><td>11</td><td><code>sunion set1名 set2名</code></td><td>获得两个set的并集</td></tr></tbody></table><h3 id="_3-2-4-hash" tabindex="-1"><a class="header-anchor" href="#_3-2-4-hash" aria-hidden="true">#</a> 3.2.4 Hash</h3><p>注：是一个Map集合（键值对key-value），本质和String没有太大区别，只不过hash更适合存储对象</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>hset hash名 键 值</code></td><td>添加键值对</td></tr><tr><td>2</td><td><code>hget hash名 指定键</code></td><td>根据指定键得到值</td></tr><tr><td>3</td><td><code>hmset hash名 键1 值1 键2 值2 ...</code></td><td>同时设置多个键值对</td></tr><tr><td>4</td><td><code>hmget hash名 键1 键2 ...</code></td><td>同时获取多个值</td></tr><tr><td>5</td><td><code>hgetall hash名</code></td><td>获取全部的键值对</td></tr><tr><td>6</td><td><code>hdel hash名 指定键</code></td><td>删除指定键的键值对</td></tr><tr><td>7</td><td><code>hlen hash名</code></td><td>获取hash的字段数量</td></tr><tr><td>8</td><td><code>hexists hash名 指定键</code></td><td>判断指定键对应的键值对是否存在</td></tr><tr><td>9</td><td><code>hkeys hash名</code></td><td>获取hash所有的键</td></tr><tr><td>10</td><td><code>hvals hash名</code></td><td>获取hash所有的值</td></tr><tr><td>11</td><td><code>hincrby hash名 指定键 增量</code></td><td>将指定键的值增加对应增量（增量也可以是负的）</td></tr><tr><td>12</td><td><code>hsetnx hash 键 值</code></td><td>不存在则添加，否则不添加</td></tr></tbody></table><h3 id="_3-2-5-zset" tabindex="-1"><a class="header-anchor" href="#_3-2-5-zset" aria-hidden="true">#</a> 3.2.5 Zset</h3><p>注：在set的基础上增加了一个score，zset是有序的</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>zadd zset名 score 值</code></td><td>添加值</td></tr><tr><td>2</td><td><code>zadd zset名 score1 值1 score2 值2 ...</code></td><td>同时添加多个值</td></tr><tr><td>3</td><td><code>zrangebyscore zset名 -inf +inf withscores</code></td><td>根据score的大小从小到大排序排序查询，查询结果的score范围无穷小到无穷大</td></tr><tr><td>4</td><td><code>zrevrange zset 0 -1</code></td><td>同上类似，由大到小排序查询</td></tr><tr><td>5</td><td><code>zrange zset名 起始下标结束下标</code></td><td>查看范围内的值</td></tr><tr><td>6</td><td><code>zrem zset名 指定值</code></td><td>删除指定的值</td></tr><tr><td>7</td><td><code>zcard zset名</code></td><td>获取元素个数</td></tr><tr><td>8</td><td><code>zcount zset名 起始下标 结束下标</code></td><td>统计符合范围的score对应的值的总数</td></tr></tbody></table><h2 id="_3-3-特殊类型" tabindex="-1"><a class="header-anchor" href="#_3-3-特殊类型" aria-hidden="true">#</a> 3.3 特殊类型</h2><p><strong>三种特殊类型</strong></p><ul><li>geospatial</li><li>hyperloglog</li><li>bitmaps</li></ul><h3 id="_3-3-1-geospatial" tabindex="-1"><a class="header-anchor" href="#_3-3-1-geospatial" aria-hidden="true">#</a> 3.3.1 geospatial</h3><p>注：底层实现原理是zset，所以能用zset的命令操作</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>geoadd 键 值（经度 纬度 名称）</code></td><td>添加地理位置</td></tr><tr><td>2</td><td><code>geopos 键 值的名称</code></td><td>获取经纬度</td></tr><tr><td>3</td><td><code>geodist 键 名称1 名称2 单位</code></td><td>获取两地之间的直线距离</td></tr><tr><td>4</td><td><code>georadius 键 值（经度 纬度） 半径 单位 ...</code></td><td>查询出在半径内的所有已存储的地理位置</td></tr><tr><td>5</td><td><code>georadiusbymember 键 名称 半径 单位 ...</code></td><td>以地理位置为中心搜寻半径内的其他地理位置</td></tr><tr><td>6</td><td><code>geohash 键 名称1 名称2 ...</code></td><td>将地理位置转换成11位的 <code>geohash</code> 字符串</td></tr></tbody></table><h3 id="_3-3-2-hyperloglog" tabindex="-1"><a class="header-anchor" href="#_3-3-2-hyperloglog" aria-hidden="true">#</a> 3.3.2 hyperloglog</h3><p>注：这是一个基数统计（相同元素只记作一个）算法，相较于set的优点事hyperloglog占用的内存是固定的且较小的，2^64的不同元素只占 12 KB，且这种统计法是允许误差的</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>pfadd 键 值1 值2 ...</code></td><td>创建集合</td></tr><tr><td>2</td><td><code>pfcount 键</code></td><td>统计集合里的基数</td></tr><tr><td>3</td><td><code>pfmerge 键1 键2</code></td><td>合并两个集合</td></tr></tbody></table><h3 id="_3-3-3-bitmaps" tabindex="-1"><a class="header-anchor" href="#_3-3-3-bitmaps" aria-hidden="true">#</a> 3.3.3 bitmaps</h3><p>注：位存储，位图，也是一种数据结构</p><table><thead><tr><th>序号</th><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td><code>setbit 键 当前序号 值</code></td><td>添加元素</td></tr><tr><td>2</td><td><code>getbit 键 序号</code></td><td>获取值</td></tr><tr><td>3</td><td><code>bitcount 键</code></td><td>统计值</td></tr></tbody></table><h1 id="_4-事务" tabindex="-1"><a class="header-anchor" href="#_4-事务" aria-hidden="true">#</a> 4.事务</h1><p>注：redis 单条命令是保证原子性的，但是 redis 的事务不保证原子性，redis 事务的本质可以理解成一组命令的集合，同时也没有隔离级别的概念</p><p><strong>redis的事务：</strong></p><ul><li><p>开启事务（multi）</p></li><li><p>命令入队（ ... ），期间可以放弃事务，放弃之后队列中的命令都不会被执行</p></li><li><p>执行事务（exec）；取消事务（discard）</p></li><li><p>编译型异常，即代码本身有问题，那么事务中的所有命令都不会被执行</p></li><li><p>运行时异常 ( 如：1/0 )，即如果事务队列中存在语法性错误，那么执行命令的时候其他的命令还是可以执行的，只有错误命令才会抛出异常，所以说单条保证原子性，但事务不保证原子性</p></li><li><p>监控（watch）：悲观锁和乐观锁，乐观锁由于不会主动加锁，所以需要判断数据是否修改，将判断结果存入 version 中，执行命令时先获取 version，根据version 决定是否更新数据</p></li></ul><h1 id="_5-jedis" tabindex="-1"><a class="header-anchor" href="#_5-jedis" aria-hidden="true">#</a> 5.Jedis</h1><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>Jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_6-spring-boot-整合-redis" tabindex="-1"><a class="header-anchor" href="#_6-spring-boot-整合-redis" aria-hidden="true">#</a> 6.Spring Boot 整合 redis</h1><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Spring Boot 2.x 的 redis 整合 没有使用 Jedis 而是 lettuce</li><li>Jedis 采用了智联，多线程操作是不安全的，如果需要避免不安全需要使用 Jedis pool 连接池，更像 BIO 模式</li><li>lettuce 采用 netty，实例可以在多个线程中进行共享，不存在线程不安全的请路况，可以减少线程数据，更像 NIO 模式</li></ul><p><strong>简单的自定义配置：</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 序列化配置</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> objectJackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span><span class="token constant">NON_FINAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectJackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// key 采用 String 的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hash 的 key 也采用 String 的序列化方式</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// value 序列化方式采用 jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>objectJackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// hash 的 value 序列化方式采用 jackson</span>
        template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>objectJackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_7-redis-持久化" tabindex="-1"><a class="header-anchor" href="#_7-redis-持久化" aria-hidden="true">#</a> 7.Redis 持久化</h1><ul><li>rdb 保存的文件是 dump.rdb，aof 保存的文件是 appendonly.aof 文件</li><li>redis 会在指定的时间间隔内将内存中的数据集快照写入磁盘，它恢复时时将快照文件直接读到内存中</li><li>redis 会单独创建（fork）一个子进程来进行持久化，先将数据写到一个临时文件中，待持久化过程都结束了，再用这个零食文件替换上吃持久化好的文件</li><li>上述过程中，主进程不进行任何 IO 操作，这确保了极高的性能。</li><li>如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那么 rdb 的方式要比 aof 的方式更加高效，但是 rdb 有可能会将最后一次持久化后的数据丢失</li></ul><h2 id="_7-1-rdb" tabindex="-1"><a class="header-anchor" href="#_7-1-rdb" aria-hidden="true">#</a> 7.1 rdb</h2><p><strong>1.rdb 文件保存的触发规则：</strong></p><ul><li>配置文件中 save 的规则满足的情况下会触发</li><li>执行 flushall 命令会触发</li><li>退出 redis 时会触发</li><li>备份会触发</li></ul><p><strong>2.恢复 rdb 文件：</strong></p><ul><li>只需要将 rdb 文件放在 redis 的启动目录即可</li></ul><p>**3.优缺</p><ul><li>适合大规模的数据恢复</li><li>对数据的完整性要求不高</li><li>需要一定时间进行进程操作，如果中途出意外，那么最后一次修改的数据可能丢失</li><li>fork 进行的时候会占用一定的空间</li></ul><h2 id="_7-2-aof" tabindex="-1"><a class="header-anchor" href="#_7-2-aof" aria-hidden="true">#</a> 7.2 aof</h2><ul><li>将所有命令都记录下来，恢复时会把这个文件的命令全部执行一遍</li><li>以日志的形式记录每个写操作，将 redis 执行过的所有命令都记录下来（读操作不记录）</li><li>只能追加文件，不能改写文件</li><li>默认不开启，开启将 appendonly 改为 yes 即可</li></ul><p><strong>1.优缺点：</strong></p><ul><li>每次修改都会同步，文件完整性更好</li><li>默认每秒同步一次，可能丢失疫苗数据</li><li>不同步效率更高</li><li>相对于数据文件来说，aof 远远大于 rdb，修复的速度也比 rdb 慢</li><li>aof 的运行效率也比 rdb 低</li></ul><h1 id="_8-redis-的发布订阅" tabindex="-1"><a class="header-anchor" href="#_8-redis-的发布订阅" aria-hidden="true">#</a> 8.Redis 的发布订阅</h1><ul><li>redis 发布订阅（pub/sub）是一种消息通信模式</li><li>Redis 客户端可以订阅任意数量的频道</li><li>订阅发布机制的底层原理： <ul><li>通过 subscribe 订阅某频道后，redis-server 里会维护一个字典，建为 channel，值为链表，链表中保存了所有订阅这个 channel 的客户端，当客户护短订阅时就会将其添加到这个订阅链表中</li><li>通过 publish 向订阅者发送消息，redis-server 会使用给定的频道作为建，在所维护的链表中查找订阅了这个频道的客户端链表，遍历链表将消息发布给所有订阅者</li></ul></li></ul><table><thead><tr><th style="text-align:center;">序号</th><th style="text-align:center;">命令</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">publish channel message</td><td style="text-align:center;">将消息发送到指定的频道</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">punsubscribe [pattern[pattern...]]</td><td style="text-align:center;">退订所有给定模式的频道</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">subscribe channel[channel...]]</td><td style="text-align:center;">订阅给定的一个或多发个频道的消息</td></tr><tr><td style="text-align:center;">4</td><td style="text-align:center;">unsubscribe [channel[channel...]]</td><td style="text-align:center;">指定退订的频道</td></tr><tr><td style="text-align:center;">5</td><td style="text-align:center;">pubsub subcommand [argument[argument...]]</td><td style="text-align:center;">查看订阅与发布系统状态</td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;">psubscribe pattern[pattern...]</td><td style="text-align:center;">订阅一个或多个符合给定模式的频道</td></tr></tbody></table><h1 id="_9-redis-主从复制" tabindex="-1"><a class="header-anchor" href="#_9-redis-主从复制" aria-hidden="true">#</a> 9.Redis 主从复制</h1><ul><li>将一台 redis 服务器的数据复制到其他 redis 服务器。前者称为主节点 master/leader，后者称为从节点 slave/follower</li><li>数据的复制时单向的，只有由主节点到从节点。master 以写为主，slave 以读为主</li><li>默认情况下，每台 redis 服务器都是主节点，一个主节点可以有多个从节点，但一个从节点只能有一个主节点</li><li>主从复制的作用主要包括： <ul><li>数据冗余：主从复制实现了数据的热备份，时持久化之外的一种数据冗余方式</li><li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复，这是一种服务的冗余</li><li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务，分担服务器的压力</li><li>高可用：主从复制还是哨兵和集群能够实施的基础，因此也是高可用的基础</li></ul></li><li>主从复制实现读写分离一般都是使用一主二从</li><li>当 slave 成功连接到 master 后会发送一个 sync 同步命令，master 接收命令后会启动后台的存盘进程，同时收集所有接收到的用于修改数据集的命令，在后台程序执行完毕之后 master 将传送整个数据文件到 slave 并完成一次同步（只要是连接到主机就会进行一次全量复制） <ul><li>全量复制：slave 服务在接收到数据库文件后将其存盘并加载到内存中</li><li>增量复制：master 继续将新的收集到的修改命令传给 slave 完成同步</li></ul></li></ul><table><thead><tr><th style="text-align:center;">序号</th><th style="text-align:center;">命令</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">info replication</td><td style="text-align:center;">查看主从信息</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">slaveof ip port</td><td style="text-align:center;">指定主节点</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">slaveof no one</td><td style="text-align:center;">让当前节点成为主节点</td></tr></tbody></table><h2 id="_9-1-哨兵模式" tabindex="-1"><a class="header-anchor" href="#_9-1-哨兵模式" aria-hidden="true">#</a> 9.1 哨兵模式</h2><ul><li><p>主从切换：当主服务器宕机后，使用哨兵模式会根据投票数自动将某一个从节点变成主节点</p></li><li><p>哨兵是 redis提供的一种特殊的模式，是一个独立的进程。原理是哨兵通过发送命令等待 redis 服务相应从而监控运行的多个 redis 实例是否可用</p></li><li><p>哨兵的作用：</p><ul><li>通过发送命令监控 redis 集群的状态</li><li>当哨兵检测到 master 宕机时会将 slave 切换成 master，然后通过发布订阅模式通知其他的从服务器修改配置文件，以此让它们自动切换主节点</li></ul></li><li><p>通常哨兵也会搭建一个集群形成多哨兵模式保证高可用</p></li><li><p>在多哨兵模式下，要是其中一个哨兵检测到主节点宕机，并不会立即执行 failover（故障转移）过程，因为这仅仅是这个哨兵认为主节点不可用，这称为主观下线。之后的哨兵也检测到主节点不可用并且达到一定数量时，哨兵之间会进行一次投票，投票结果由一个哨兵发起并进行 failover 操作。切换成功后就会通过发布订阅模式让各个哨兵切换主节点，这个过程称为客观下线</p></li></ul><h1 id="_10-redis-缓存穿透、击穿、雪崩" tabindex="-1"><a class="header-anchor" href="#_10-redis-缓存穿透、击穿、雪崩" aria-hidden="true">#</a> 10.Redis 缓存穿透、击穿、雪崩</h1><p><strong>3.缓存穿透：</strong></p><ul><li>当用户查询数据时，要是 redis 中没有，即缓存没命中，就会到数据库中查询，要是在数据库中也没有，那么本次查询失败</li><li>当用户很多或者有人恶意执行上述查询失败的操作时，就会造成数据库压力很大，此时就相当于出现了缓存穿透</li><li>解决方案： <ul><li>redis 存储空对象：当存储层没命中时，将返回的空对象也存入 redis 中，同时设置一个过期时间，之后再访问这个数据时就避免了直接访问数据库。但这种方法会浪费很多空间存储空值的键，并且即使设置了过期时间，缓存层和存储层还是会有一段时间窗口不一致，这对于需要保持一致性的业务会产生影响</li><li>布隆过滤器：是一种数据结构，对所有可能查询的参数以 hash 形式存储，在控制层先进行校验，不符合则直接丢弃，避免了对底层存储系统的压力</li></ul></li></ul><p><strong>2.缓存击穿：</strong></p><ul><li>是指某个键在扛着高并发时可能会出现失效的情况</li><li>当这个键被击穿或缓存过期后会有大量请求打入数据库，并且还会写回缓存，这会导致数据库和服务器压力过大</li><li>解决方案： <ul><li>设置热点数据不过期</li><li>加互斥锁：使用分布式锁保证对于每个 key 同时只有一个线程查询，其他线程在没有获得锁时只能等待，从而降低压力，但是这样会将压力转移到分布式锁上，所以分布式锁必须设计好</li></ul></li></ul><p><strong>3.缓存雪崩：</strong></p><ul><li><p>是指在某个时间段缓存集中过期失效，或是 redis 服务不可用</p></li><li><p>解决方案：</p><ul><li>增设多几个 redis，即将 redis 集群扩容，保证服务高可用（搭建异地多活）</li><li>限流降级：在缓存失效后，通过加锁或队列来控制读数据库和写缓存得线程数量</li><li>数据预热：就是在正式部署之前见吧可能查询的数据预先访问一遍，这样部分可能大量访问的数据就会先加载到缓存中。在即将发生高并发访问前手动触发加载缓存并设置不同的过期时间，让缓存失效的时间点不会集中在一起</li></ul></li></ul></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">Last update: </span><!----></div><div class="contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: 1627121193@qq.com">格兹沃</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/article/redis/%E7%BC%93%E5%AD%98%E8%BF%9B%E9%98%B6.html" class="nav-link prev" aria-label="缓存进阶"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><FontIcon icon="缓存进阶"></FontIcon>缓存进阶</div></a><!----></nav><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><div data-v-717f1b97></div></div><!--]--><!----></div><!--]--><!--]--><!----><div id="pwa-install"><!----><div id="install-modal-wrapper" style="display:none;"><div class="background"></div><div class="install-modal"><div class="header"><button class="close-button" aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" class="icon close-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="close icon"><path d="M589.654 511.965 1007.212 84.22a49.777 49.777 0 0 0-.73-70.02 49.046 49.046 0 0 0-69.687.665L519.967 441.946 85.882 14.2a49.08 49.08 0 0 0-69.687.664 49.777 49.777 0 0 0 .664 70.019l433.454 427.082L16.859 939.048a49.777 49.777 0 0 0-.664 70.019 49.013 49.013 0 0 0 69.687.663l434.085-427.746 416.828 427.083A49.013 49.013 0 0 0 972.037 1024a48.416 48.416 0 0 0 34.512-14.27 49.777 49.777 0 0 0 .73-70.019z"></path></svg></button><div class="logo"><!----><div class="title"><h1></h1><p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div><div class="content"><div class="highlight"><!----><!----></div><div class="description"><h3>Description</h3><p></p></div></div><div class="button-wrapper"><button class="install-button">Install<span></span></button><button class="cancel-button">Cancel</button></div></div></div></div><!----><!--]--></div>
    <script type="module" src="/assets/app-f746a503.js" defer></script>
  </body>
</html>
